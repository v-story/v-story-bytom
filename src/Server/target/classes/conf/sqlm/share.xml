<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlm SYSTEM "http://10.95.26.153/dtd/sqlm_2_1.dtd" [
]>
<sqlm   ver="2.1">
	<module name="share" desc="sns공유">
		<sql name="share.regPost" execute="Update" type="PreparedStatement" desc="공유하기 등록">
			<puts>
				<!--
				INSERT INTO TB_POST
					(ACCOUNTPK, CONT, PIC_CNT, VIDEO_CNT)
				VALUES
					(:ACCOUNTPK, :CONT, :PIC_CNT, :VIDEO_CNT)	
				-->	
				INSERT INTO TB_POST (ACCOUNTPK, CONT, PIC_CNT, VIDEO_CNT) SELECT :ACCOUNTPK, :CONT, :PIC_CNT, :VIDEO_CNT FROM DUAL
				WHERE NOT EXISTS ( SELECT POST_SEQ FROM TB_POST WHERE ACCOUNTPK = :ACCOUNTPK AND REG_TIME > DATE_ADD(NOW(), INTERVAL -5 SECOND) )
			</puts>
		</sql>				
		<sql name="share.getPostWeight_SNS" execute="Select" type="PreparedStatement" desc="게시물 가중치 얻기">
			<param name="POST_SEQ" 		required="yes" 	desc="" />
			<puts>
				SELECT WEIGHT FROM TB_POST WHERE POST_SEQ = $POST_SEQ
			</puts>
		</sql>		



		<sql name="share.getTagCnt_SNS" execute="Select" type="PreparedStatement" desc="태그 개수">
			<param name="TAG_NM" 		required="yes" 	desc="" />
			<puts>
				SELECT TAG_SEQ FROM TB_TAG WHERE TAG_NM = '$TAG_NM'
			</puts>
		</sql>		
		<sql name="share.regTag_SNS" execute="Update" type="PreparedStatement" desc="게시물 태그에 등록">
			<param name="TAG_NM" 		required="yes" 	desc="" />
			<puts>
				INSERT INTO TB_TAG (TAG_NM, POST_CNT) VALUES ('$TAG_NM', 1)
			</puts>
		</sql>
		<sql name="share.modTag_SNS" execute="Update" type="PreparedStatement" desc="게시물 태그에 카운트 증가">
			<param name="TAG_SEQ" 		required="yes" 	desc="" />
			<puts>
				UPDATE TB_TAG SET POST_CNT = POST_CNT + 1 WHERE TAG_SEQ = $TAG_SEQ
			</puts>
		</sql>
		<sql name="share.regTagPost_SNS" execute="Update" type="PreparedStatement" desc="게시물 태그 매핑에 등록">
			<param name="ACCOUNTPK" 		required="yes" 	desc="" />
			<param name="POST_SEQ" 			required="yes" 	desc="" />
			<param name="TAG_SEQ" 			required="yes" 	desc="" />
			<puts>
				<!-- INSERT INTO TB_TAG_POST (ACCOUNTPK, POST_SEQ, TAG_SEQ) VALUES ($ACCOUNTPK, $POST_SEQ, $TAG_SEQ) -->
				<!-- 
				INSERT INTO TB_TAG_POST (ACCOUNTPK, POST_SEQ, TAG_SEQ) SELECT $ACCOUNTPK, $POST_SEQ, $TAG_SEQ  FROM DUAL
				WHERE NOT EXISTS ( SELECT * FROM TB_TAG_POST WHERE POST_SEQ = $POST_SEQ AND TAG_SEQ = $TAG_SEQ )
				-->
				INSERT INTO TB_TAG_POST (ACCOUNTPK, POST_SEQ, TAG_SEQ) VALUES ($ACCOUNTPK, $POST_SEQ, $TAG_SEQ)
				ON DUPLICATE KEY UPDATE CNT = CNT+1
			</puts>
		</sql>
				
		<sql name="share.regFileinfo" execute="Update" type="PreparedStatement" desc="파일정보 등록">
			<puts>
				INSERT INTO TB_FILE_INFO
					(POST_SEQ, COMMENT_SEQ, FILE_PATH, FILE_NM, FILE_NUM, FILE_TYPE)
				VALUES
					(:POST_SEQ, :COMMENT_SEQ, :FILE_PATH, :FILE_NM, :FILE_NUM, :FILE_TYPE)
			</puts>
		</sql>

		<sql name="share.regHomePost" execute="Update" type="PreparedStatement" desc="게시물 등록">
			<puts>
				INSERT INTO TB_HOME_POST
					(ACCOUNTPK, POST_SEQ, PIC_EXIST_YN, VIDEO_EXIST_YN, WEIGHT)
				VALUES
					(:ACCOUNTPK, :POST_SEQ, :PIC_EXIST_YN, :VIDEO_EXIST_YN, :WEIGHT)	
			</puts>
		</sql>
		<sql name="share.modCounter" execute="Update" type="PreparedStatement" desc="게시물 등록">
			<puts>
				UPDATE TB_COUNTER SET
					POST_CNT = POST_CNT + 1
				WHERE
					ACCOUNTPK = :ACCOUNTPK
			</puts>
		</sql>
		<sql name="share.regSNSQuestCond_SNS" execute="Update" type="PreparedStatement" desc="">
			<param name="ACCOUNTPK" 			required="yes" 	desc="" />
			<param name="TEAM_ACCOUNTPK" 		required="yes" 	desc="" />
			<param name="QUEST_ID" 				required="yes" 	desc="" />
			<param name="COND_TYPE" 			required="yes" 	desc="" />
			<puts>
				INSERT INTO TB_SNSQUEST_COND
					(ACCOUNTPK, TEAM_ACCOUNTPK, QUEST_ID, COND_TYPE, REG_DATE)
				VALUES
					($ACCOUNTPK, $TEAM_ACCOUNTPK, $QUEST_ID, $COND_TYPE, NOW())	
			</puts>
		</sql>
		
	</module>
</sqlm>
